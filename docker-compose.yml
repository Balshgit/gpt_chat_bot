version: '3.9'

networks:
  healthcheck_bot_network:
    name:
      "healthcheck_bot_network"

volumes:
  healthcheck_bot_caddy-data:
    name: healthcheck_bot_caddy-data
  healthcheck_bot_caddy-config:
    name: healthcheck_bot_caddy-config


services:

  bot:
    container_name: "healthcheck_bot"
    hostname: "healthcheck_bot"
    image: "healthcheck_bot:latest"
    build:
      context: .
      dockerfile: deploy/Dockerfile
      args:
        USER: ${USER}
    restart: unless-stopped
    env_file:
      - settings/.env
    volumes:
      - /etc/localtime:/etc/localtime:ro
    networks:
      healthcheck_bot_network:
        ipv4_address: 200.20.0.10
    expose:
      - "8080"
    command: bash start-bot.sh

  caddy:
    image: "caddy:2.7.4"
    container_name: healthcheck_bot_caddy
    hostname: healthcheck_bot_caddy
    restart: unless-stopped
    env_file:
      - settings/.env
    ports:
      - '8085:8085'
    depends_on:
      - bot
    volumes:
      - ./deploy/Caddyfile:/etc/caddy/Caddyfile:ro
      - healthcheck_bot_caddy-data:/data
      - healthcheck_bot_caddy-config:/config
    networks:
      healthcheck_bot_network:
        ipv4_address: 200.20.0.11
